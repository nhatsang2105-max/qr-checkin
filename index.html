<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QR Check-in</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #reader {
      width: 300px;
      margin: 20px auto;
    }
    #result {
      margin-top: 15px;
      font-size: 1.2em;
      color: #333;
    }
  </style>
  <!-- Thư viện HTML5 QR Code -->
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
</head>
<body>

  <h2>Quét mã QR để điểm danh</h2>
  <div id="reader"></div>
  <div id="result">Chưa quét.</div>

  <script>
    // URL Google Apps Script Web App của bạn
    const API_URL = 'YOUR_SCRIPT_WEB_APP_URL';

    // Hàm chạy khi quét thành công
    function onScanSuccess(decodedText, decodedResult) {
      // Ngừng scanner để không quét trùng lặp
      html5QrCode.stop().catch(err => console.warn(err));

      // Hiển thị tạm
      document.getElementById('result').innerText = 'Đang xác thực...';

      // Gọi API với mã QR
      fetch(`${API_URL}?code=${encodeURIComponent(decodedText)}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('result').innerText = data.message;
        })
        .catch(err => {
          console.error(err);
          document.getElementById('result').innerText = 'Lỗi kết nối server.';
        });
    }

    // Khởi tạo Html5Qrcode
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      { facingMode: "environment" },   // chọn camera sau
      { fps: 10, qrbox: 250 },         // cấu hình tốc độ và kích thước vùng quét
      onScanSuccess,
      errorMessage => {
        // callback khi quét không thành công (bỏ qua)
      }
    ).catch(err => {
      console.error("Không khởi động được camera:", err);
      document.getElementById('result').innerText = 'Không truy cập được camera.';
    });
  </script>

</body>
</html>
